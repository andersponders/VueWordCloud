!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.VueWordCloud=n()}(this,function(){"use strict";function c(t){return"function"==typeof t}function L(){}var h=function(t){this.previousValue=t,this.interrupted=!1,this.interruptHandlers=new Set};h.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},h.prototype.interrupt=function(){this.interrupted||(this.interrupted=!0,this.interruptHandlers.forEach(function(t){try{t()}catch(t){}}))},h.prototype.onInterrupt=function(t){if(this.interrupted&&!this.interruptHandlers.has(t))try{t()}catch(t){}this.interruptHandlers.add(t)};var t="asyncComputed_",l=t+"promise_",d=t+"trigger_";function n(t){return function(){return t}}function i(){return[]}var e={animationDuration:{type:Number,default:1e3},animationEasing:{type:String,default:"ease"},animationOverlap:{type:Number,default:1},color:{type:[String,Function],default:"Black"},createCanvas:{type:Function,default:function(){return document.createElement("canvas")}},createWorker:{type:Function,default:function(t){return new Worker(URL.createObjectURL(new Blob([t])))}},enterAnimation:{type:[Object,String],default:n({opacity:0})},fontFamily:{type:[String,Function],default:"serif"},fontSizeRatio:{type:Number,default:0},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},leaveAnimation:{type:[Object,String],default:n({opacity:0})},loadFont:{type:Function,default:function(t,n,i,e){return document.fonts.load([n,i,"1px",t].join(" "),e)}},rotation:{type:[Number,Function],default:0},rotationUnit:{type:[String,Function],default:"turn"},spacing:{type:Number,default:0},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},words:{type:Array,default:i}};var s=n(null);function N(t){return t&&"object"==typeof t}function k(t){return"string"==typeof t}var r={animationOptions:function(){var t,e,r,i=this.animationDuration,n=this.enterAnimation,o=this.leaveAnimation;if(N(n)&&N(o)){var u=(t=Object.assign({},n,o),e=s,r={},Object.entries(t).forEach(function(t){var n=t[0],i=t[1];r[n]=e(i,n)}),r),a=function(t){Object.assign(t.style,n)},f=function(t,n){setTimeout(function(){Object.assign(t.style,u),setTimeout(n,i)},1)};return{props:{css:!1},on:{beforeAppear:a,appear:f,beforeEnter:a,enter:f,leave:function(t,n){Object.assign(t.style,o),setTimeout(n,i)}}}}return k(n)&&k(o)?{props:{duration:i,appear:!0,appearActiveClass:n,enterActiveClass:n,leaveActiveClass:o}}:{}},normalizedAnimationOverlap:function(){var t=this.animationOverlap;return(t=Math.abs(t))<1&&(t=1/t),t},separateAnimationDelay:function(){var t=this.cloudWords;if(1<t.length)return(this.animationDuration-this.separateAnimationDuration)/(t.length-1);return 0},separateAnimationDuration:function(){var t=this.cloudWords;if(0<t.length){var n=this.animationDuration,i=this.normalizedAnimationOverlap;return n/Math.min(i,t.length)}return 0}};function z(t){return c(t)?t:n(t)}function D(t){return void 0===t}function H(t,n){return t.postMessage(n),o=t,new Promise(function(i,e){var r,t=function(t){var n=t.data;r(),i(n)},n=function(t){var n=t.error;r(),e(n)};r=function(){o.removeEventListener("message",t),o.removeEventListener("error",n)},o.addEventListener("message",t),o.addEventListener("error",n)});var o}function A(t,n,i){return Math.ceil(t*Math.abs(Math.sin(i))+n*Math.abs(Math.cos(i)))}function P(t,n,i){return Math.ceil(t*Math.abs(Math.cos(i))+n*Math.abs(Math.sin(i)))}function B(t,n,i,e,r){return[t,n,i,e+"px",r].join(" ")}function E(t,n){return Math.ceil(t/n)*n}function T(t,n,i){var e=i().getContext("2d");return e.font=n,e.measureText(t).width}var _=function(t,n,i,e,r,o,u){this.t=t,this.n=n,this.i=i,this.e=e,this.r=r,this.o=o,this.u=u,this.a=1,this.f=0,this.s=0,this.c=0},o={h:{configurable:!0},l:{configurable:!0},d:{configurable:!0},v:{configurable:!0},p:{configurable:!0},m:{configurable:!0},g:{configurable:!0},b:{configurable:!0},y:{configurable:!0},M:{configurable:!0},w:{configurable:!0},S:{configurable:!0},x:{configurable:!0},O:{configurable:!0},F:{configurable:!0},j:{configurable:!0},W:{configurable:!0},A:{configurable:!0},P:{configurable:!0}};o.h.get=function(){return this.a},o.h.set=function(t){this.a!==t&&(this.a=t,this.B=void 0)},o.l.get=function(){return B(this.o,this.r,this.e,this.h,this.i)},o.d.get=function(){return void 0===this.T&&(this.T=T(this.t,B(this.o,this.r,this.e,1,this.i),this.u)),this.T},o.v.get=function(){return this.d*this.h},o.p.get=function(){return this.s*this.h},o.p.set=function(t){this.s=t/this.h},o.m.get=function(){return this.c*this.h},o.m.set=function(t){this.c=t/this.h},o.g.get=function(){return P(this.v,this.h,this.n)},o.b.get=function(){return A(this.v,this.h,this.n)},o.y.get=function(){return this.p-this.g/2},o.M.get=function(){return this.m-this.b/2},o.w.get=function(){return this.f},o.w.set=function(t){this.f!==t&&(this.f=t,this.B=void 0)},o.S.get=function(){return void 0===this.B&&(this.B=function(t,n,i,e,r,o,u,a,f){var s=B(n,i,e,r*=4,o),c=T(t,s,f),h=u*r*2,l=f(),d=l.getContext("2d"),v=E(P(h+2*r+c,h+3*r,a),4),p=E(A(h+2*r+c,h+3*r,a),4);l.width=v,l.height=p,d.translate(v/2,p/2),d.rotate(a),d.font=s,d.textAlign="center",d.textBaseline="middle",d.fillText(t,0,0),0<h&&(d.miterLimit=1,d.lineWidth=h,d.strokeText(t,0,0));for(var m=d.getImageData(0,0,v,p).data,g=[],b=1/0,y=0,M=1/0,w=0,S=v/4,x=p/4,O=0;O<S;++O)for(var F=0;F<x;++F)t:for(var j=0;j<4;++j)for(var W=0;W<4;++W)if(m[4*(v*(4*F+W)+(4*O+j))+3]){g.push([O,F]),b=Math.min(O,b),y=Math.max(O+1,y),M=Math.min(F,M),w=Math.max(F+1,w);break t}return 0<g.length?[g.map(function(t){var n=t[0],i=t[1];return[n-b,i-M]}),y-b,w-M,Math.ceil(S/2)-b,Math.ceil(x/2)-M]:[g,0,0,0,0]}(this.t,this.o,this.r,this.e,this.h,this.i,this.w,this.n,this.u)),this.B},o.x.get=function(){return this.S[0]},o.O.get=function(){return this.S[1]},o.F.get=function(){return this.S[2]},o.j.get=function(){return this.S[3]},o.W.get=function(){return this.S[4]},o.A.get=function(){return Math.ceil(this.p)-this.j},o.A.set=function(t){this.p=t+this.j},o.P.get=function(){return Math.ceil(this.m)-this.W},o.P.set=function(t){this.m=t+this.W},Object.defineProperties(_.prototype,o);var u,a={name:"VueWordCloud",mixins:[(u={cloudWords:{get:function(s){var t,e=this,n=this,c=n.elementWidth,h=n.elementHeight,p=n.words,i=n.text,r=n.weight,o=n.rotation,u=n.rotationUnit,a=n.fontFamily,f=n.fontWeight,l=n.fontVariant,d=n.fontStyle,v=n.color,m=n.spacing,g=n.fontSizeRatio,b=n.createCanvas,y=n.loadFont,M=n.createWorker;t=g,g=1<(t=Math.abs(t))?1/t:t;var w,S,x,O=(S=(w=[c,h])[0],(x=w[1])<S?[1,x/S]:S<x?[S/x,1]:[1,1]);if(0<c&&0<h){var F=z(i),j=z(r),W=z(o),A=z(u),P=z(a),B=z(f),E=z(l),T=z(d),C=z(v);return p=p.map(function(t,n){var i,e,r,o,u,a,f,s,c,h,l;t&&(k(t)?r=t:Array.isArray(t)?(r=(i=t)[0],o=i[1]):N(t)&&(r=(e=t).text,o=e.weight,u=e.rotation,a=e.rotationUnit,f=e.fontFamily,s=e.fontWeight,c=e.fontVariant,h=e.fontStyle,l=e.color)),D(r)&&(r=F(t,n,p)),D(o)&&(o=j(t,n,p)),D(u)&&(u=W(t,n,p)),D(a)&&(a=A(t,n,p)),D(f)&&(f=P(t,n,p)),D(s)&&(s=B(t,n,p)),D(c)&&(c=E(t,n,p)),D(h)&&(h=T(t,n,p)),D(l)&&(l=C(t,n,p));var d=new _(r,function(){switch(a){case"turn":return u*Math.PI*2;case"deg":return u*Math.PI/180}return u}(),f,s,c,h,b);return Object.assign(d,{C:t,L:o,N:l}),d}),Promise.resolve().then(function(){return Promise.all(p.map(function(t){var n=t.i,i=t.o,e=t.e,r=t.t;return y(n,i,e,r)}))}).catch(L).then(function(){if(0<(p=p.filter(function(t){return 0<t.v}).sort(function(t,n){return n.L-t.L})).length){var t=p[0],n=(i=p)[i.length-1],r=t.L,o=n.L;if(o<r){var u=0<g?1/g:0<o?r/o:r<0?o/r:1+r-o;p.forEach(function(t){var n,i,e;t.h=(n=t.L,(e=1)+(n-(i=o))*(u-e)/(r-i))})}p.reduceRight(function(t,n){return n.h<2*t?n.h/=t:(t=n.h,n.h=1),n.k=t},1),p.forEach(function(t){t.h*=4});var a=M('!function(){"use strict";var c=function(t){self.removeEventListener("message",c);var i,n,o,r,s,f=t.data,e=function(){i=[],s=r=o=n=0};e();var a=function(){return{left:Math.ceil((n+o)/2),top:Math.ceil((r+s)/2),width:o-n,height:s-r,pixels:i}},u=function(e,t,n){return function(t,n,r){var e,f,a=t[0],u=t[1],i=n[0],o=n[1];u<a?(e=1,f=u/a):e=a<u?(f=1,a/u):f=1;var s=[i,o];if(r(s))return s;for(var c=i,v=o;;){c+=e,v+=f;for(var l=Math.ceil(c),h=Math.ceil(v),M=0;M<h;++M){var g=[l,M];if(r(g))return g}for(var d=0;d<l;++d){var m=[d,h];if(r(m))return m}}}(f,[0,0],function(t){var a,u,n=t[0],r=t[1];return a=n,u=r,e.every(function(t){var n=t[0],r=t[1],e=a+n,f=u+r;return!i[e]||!i[e][f]})})};self.postMessage({}),self.addEventListener("message",function(t){self.postMessage({getBounds:a,put:function(t,a,u){t.forEach(function(t){var n=t[0],r=t[1],e=a+n,f=u+r;i[e]||(i[e]=[]),i[e][f]=!0,o=Math.max(e+1,o),s=Math.max(f+1,s)})},findFit:u,clear:e}[t.data.name].apply(null,t.data.args))})};self.addEventListener("message",c)}();\n'),f={completedWords:0,totalWords:p.length};return Promise.resolve().then(function(){return s.throwIfInterrupted(),e.progress=f,H(a,O)}).then(function(){var t=p[0];return t.w=m,H(a,{name:"findFit",args:[t.x,t.A,t.P]})}).then(function(t){var n=t[0],i=t[1];s.throwIfInterrupted();var e=p[0];e.A=n,e.P=i,e.w=0}).then(function(){s.throwIfInterrupted(),f.completedWords++;var n=Promise.resolve();return p.reduce(function(t,e,r){return n=n.then(function(){return e.k<t.k?Promise.resolve().then(function(){return H(a,{name:"clear"})}).then(function(){var n=Promise.resolve(),i=t.k/e.k;return p.slice(0,r).forEach(function(t){n=n.then(function(){return t.h*=i,H(a,{name:"put",args:[t.x,t.A,t.P]})})}),n}):H(a,{name:"put",args:[t.x,t.A,t.P]})}).then(function(){return e.w=m,H(a,{name:"findFit",args:[e.x,e.A,e.P]})}).then(function(t){var n=t[0],i=t[1];s.throwIfInterrupted(),f.completedWords++,e.A=n,e.P=i,e.w=0}),e}),n}).then(function(){return H(a,{name:"put",args:[n.x,n.A,n.P]})}).then(function(){return H(a,{name:"getBounds"})}).then(function(t){var n=t.left,i=t.top,e=t.width,r=t.height,o=t.pixels;if(console.log(o),0<e&&0<r){var u=Math.min(c/e,h/r);p.forEach(function(t){t.p-=n,t.m-=i,t.h*=u})}var v=new Set;return p.map(function(t){for(var n=t.C,i=t.t,e=t.L,r=t.n,o=t.i,u=t.e,a=t.r,f=t.o,s=t.l,c=t.p,h=t.m,l=t.N,d=JSON.stringify([i,o,u,a,f]);v.has(d);)d+="!";return v.add(d),{key:d,word:n,text:i,weight:e,rotation:r,font:s,color:l,left:c,top:h}})}).catch(function(t){console.error(t)}).finally(function(){a.terminate()}).finally(function(){s.throwIfInterrupted(),e.progress=null})}var i;return[]})}return[]},default:i,errorHandler:function(t){console.warn(t)}}},{data:function(){var n={};return Object.keys(u).forEach(function(t){n[d+t]={}}),n},computed:{},beforeCreate:function(){var f=this,s=new Set;Object.entries(u).forEach(function(t){var e=t[0],n=t[1],r=n.get,o=n.default,i=n.errorHandler;void 0===i&&(i=L);var u,a=!0;f.$options.computed[e]=function(){return this[d+e],this[l+e],o},f.$options.computed[l+e]=function(){var n=this;u&&(u.interrupt(),s.delete(u)),a&&(a=!1,c(o)&&(o=o.call(this)));var i=new h(o);u=i,s.add(u),new Promise(function(t){t(r.call(n,i))}).then(function(t){i.throwIfInterrupted(),o=t,n[d+e]={}})}})}})],props:e,data:function(){return{elementWidth:0,elementHeight:0,progress:null}},computed:r,watch:{cloudWords:function(t){this.$emit("update:cloudWords",t)},progress:{handler:function(t){this.$emit("update:progress",t)},deep:!0,immediate:!0}},mounted:function(){var n,i,e,r,t=this;n=function(){if(t._isDestroyed)return!1;t.updateElementSize()},i=1e3,e=function(t){requestAnimationFrame(function(){!1!==n()&&setTimeout(t,i)})},(r=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e.call.apply(e,[this,r].concat(t))})()},methods:{updateElementSize:function(){var t=this.$el;t&&(this.elementWidth=t.offsetWidth,this.elementHeight=t.offsetHeight)}},render:function(h){var t=this,l=t.$scopedSlots,d=t.animationEasing,v=t.animationOptions,n=t.cloudWords,p=t.separateAnimationDelay,m=t.separateAnimationDuration;return l=Object.assign({},{default:function(t){return t.text}},l),h("div",{style:{height:"100%",position:"relative",width:"100%"}},[h("div",{style:{left:"50%",position:"absolute",top:"50%",transform:"translate(-50%,-50%)"}},n.map(function(t,n){var i=t.color,e=t.font,r=t.left,o=t.rotation,u=t.rotationUnit,a=t.text,f=t.top,s=t.weight,c=t.word;return h("transition",Object.assign({},v),[h("div",{key:n,style:Object.assign({},{left:r+"px",position:"absolute",top:f+"px"},0<m?{animation:[m+"ms",d,p*n+"ms"].join(" "),transition:["all",m+"ms",d,p*n+"ms"].join(" ")}:{})},[h("div",{style:Object.assign({},{color:i,font:e,left:"50%",position:"absolute",top:"50%",transform:["translate(-50%,-50%)","rotate("+o+u+")"].join(" "),whiteSpace:"nowrap"},0<m?{transition:["all",m+"ms",d,p*n+"ms"].join(" ")}:{})},[l.default({color:i,font:e,left:r,text:a,top:f,weight:s,word:c})])])])}))])}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(a.name,a),a});
